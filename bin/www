#!/usr/bin/env node
const PORT = 8081;

const ws = require('ws');
const http = require('http');
const app = require('../app');
const server = http.createServer(app);


const wss = new ws.Server({server});
let mySql = {};
wss.on('connection',function (socket) {
    socket.on('message',function (data) {
        var obj = JSON.parse(data);
        if(obj.event === 'signup') {
            if(!mySql[obj.user]) {
                mySql[obj.user] = obj.password;
                socket.send(200);
            } else {
                socket.send(409);
            }
        } else if(obj.event === 'signin'){
            if(!mySql[obj.user]) {
                socket.send(404);
            } else {
                socket.send(200);
            }
        }
    });
});

server.listen(PORT);



